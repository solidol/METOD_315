\chapter{Створення  CGI-сценаріїв на мові Perl}

\section*{Анотація} 
Стандарт CGI. Сценарії. Сценарні мови: класифікація за швидкодією. Мова Python. Мова Ruby. Технологія ASP. 

\section*{План лекції}
\begin{enumerate}
\item Запуск сценарію
\item Скалярні змінні
\item Робота з файлами
\item Регулярні вирази


\end{enumerate}

\section{Запуск сценарію}

Мова Perl (Practical Extraction and Report Language) - це мова програмування, сильними сторонами якого вважаються його багаті можливості для роботи з текстом, в тому числі реалізовані за допомогою регулярних виразів. Також мова відома тим, що має величезну колекцію додаткових модулів CPAN .

Щоб запустити програму на мові Perl на виконання, її компіляція не потрібно, вона цілком може виконуватися під керуванням інтерпретатора. щоб файл з вихідним текстом Perl можна було запускати на виконання, треба щоб перша його рядок виглядала так:
\begin{verbatim}
#! Путь_к_інтерпретатору_Perl 
\end{verbatim}
  

Основними типами даних в мові є: скаляри, масиви (скалярні), хеш-таблиці (асоціативні масиви), функції, файлові дескриптори і константи.

Змінні різних типів відрізняються знаком, який стоїть перед ім'ям змінної:

\$a - скаляр або покажчик

@b - скалярний масив

\%c - асоціативний масив (хеш-таблиця)

\&d - функція

F - дескриптор введення-виведення або константа

\section{Скалярні змінні}

Скалярні змінні використовуються для зберігання одиночних значень. Вони можуть містити числа, рядки і посилання на інші об'єкти. Перед ім'ям скалярної змінної необхідно ставити знак долара '\$'. Тип скалярної змінної не фіксований і визначається динамічно в залежності від контексту.

скалярний масив є впорядкованим списком скалярів. Кожен елемент масиву має порядковий номер ( індекс), за допомогою якого до нього можна отримати доступ. Нумерація елементів починається з нуля.

Перед ім'ям змінної типу скалярний масив вказується знак @, а для доступу до певного елементу масиву необхідно ставити знак \$, так як певний елемент масиву є скаляром:
\begin{verbatim}
 @winter = ( "грудень", "січень", "лютий"); 
 print "Другий місяць зими", $winter [1], "\ n"; 
\end{verbatim}
Хеш-таблиця являє собою асоціативний масив, що дозволяє асоціювати рядок (ключ) з скаляром (значення). Рядок при цьому називається ключем, а скаляр в хеш-таблиці - значенням. Перед ім'ям змінної-списку необхідно ставити знак відсотка\%, а для доступу до певного елементу масиву ставлять знак \$.

Фактично хеш-таблиця являє собою масив, де в непарних позиціях знаходяться ключі, а на парних - значення.

Використання асоціативних масивів нагадує використання масивів скалярних значень, проте індексація проводиться не цілими числами, а ключовими словами. Крім того, індекси полягають не в квадратні, а в фігурні дужки.

Так, наприклад, для того щоб привласнити значення трьох елементів масиву \%dict з індексами first, second і third, можна скористатися одним з двох способів, зазначених нижче.
\begin{verbatim}
 $dict { 'first'} = "перший";
 $dict { 'second'} = "другий";
 $dict { 'third'} = "третій"; 
\end{verbatim}
або
\begin{verbatim}
  %dict { 'first', 'second', 'third'} =
 "перший другий третій"; 
\end{verbatim}
Крім того, існує спосіб одночасно записати в асоціативний масив і ключові слова, і їх значення. Зробити це можна за допомогою наступного виразу:

  імя\_массіва = (ключ 1, значення 1, ключ 2, значення 2, ...); 

Для прикладу, наведеного вище, це вираз буде виглядати так:
\begin{verbatim}
 %dict = ( "first", "перший",  
 "Second", "другий",  
 "Third", "третій"); 
\end{verbatim}
Розглянемо наведений наступний фрагмент програми на мові Perl.
\begin{verbatim}
 while (<STDIN>)
 {Print;  } 
\end{verbatim}
Незважаючи на те, що формально програма складена правильно, вона на перший погляд може здатися безглуздою. Однак при запуску вона поводиться точно так само, як і одна з програм "відлуння". У мові Perl існує зумовлена ??скалярная змінна \$\_, яка використовується за замовчуванням. Саме в неї поміщаються дані, прочитані зі стандартного вводу, і з неї береться значення для виведення в STDOUT.

Крім \$\_ в Perl є й інші визначені змінні:

    \$] - номер версії Perl.
    \$. - номер рядка, прочитаної з файлу останньої.
    \$! - повідомлення про помилку.
    \$\$ - ідентифікатор поточного процесу.
    \$\^T - час в секундах з початку 1970 року до запуску даної програми.
    \$O - ім'я файлу, в якому міститься виконувана програма.
    \$1 ... \$ 9 - фрагменти тексту, відмічені при виконанні операції зіставлення з шаблоном. 

Подібно визначеним скалярним змінним, в Perl існують масиви, які мають спеціальну значення. Найбільш важливий з них - асоціативний масив \%ENV, що містить поточні значення змінних оточення. Щоб отримати значення змінної оточення, треба звернутися до елементу даного масиву, вказавши в якості індексу ім'я змінної оточення. Так, наведене нижче вираз записує в скалярную змінну \$path\_string значення змінної оточення PATH.

  \$path\_string = \$ENV{'PATH'}; 

Одна з перших рядків CGI-сценарія на Perl, може виглядати так

  \$method = \$ENV{'REQUEST\_METHOD'}; 

\section{Робота з файлами}


Для роботи з файлами і потоками в Perl передбачені спеціальні файлові дескриптори.

Файлові дескриптори є покажчик на файл, пристрій або PIPE канал, відкриті для запису, читання або для запису і читання. Оператор "<>" в Perl називається діамантовим оператором ( diamond operator). Він визначає операцію читання рядки з потоку, дескриптор якого міститься в кутових дужках:

 \$str = <STDIN>;  \# Читання рядки з дескриптора STDIN (стандартного потоку введення)
 @lines = <F>;  \# Читання всіх рядків з пов'язаного з дескриптором файлу F.
 print STDOUT \$str;  \# Друк в STDOUT (стандартний потік виводу) 

Для зв'язування файлу з файловим дескриптором використовується функція open. Нижче наводяться варіанти використання цієї функції:

open дескриптор\_потока> имя\_файла 	файл відкривається для виводу даних. Якщо файл з вказаним ім'ям відсутня, створюється новий файл.

open дескриптор\_потока > > имя\_файла 	файл відкривається в режимі, що дозволяє записувати дані в кінець файлу.

open дескриптор\_потока +> имя\_файла 	відкритий файл стає доступним для читання і для запису.

функція

  Сlose дескриптор\_файла 

закриває файл, пов'язаний із зазначеним дескриптором.

\section{Регулярні вирази}

До складу мови Perl входять засоби пошуку та заміни, причому, задаючи шаблон для пошуку, можна використовувати регулярні вирази. Це означає, що складні операції, що зустрічаються в спеціалізованих додатках, можна легко реалізувати в будь-який Perl-програми.

Оператор пошуку m // записується в такий спосіб:

  m / шаблон / 

якщо значення змінної \$\_ містить підрядок, відповідну зазначеному шаблоном, оператор пошуку повертає значення true.

Розглянемо наступний приклад:
\begin{verbatim}
 $_ = <INPUT>; 
 if (m / Scripts /)
 {Print "У URL є каталог Scripts \ n";  } 
 else
 {Print "У URL немає каталогу Scripts \ n";  } 
\end{verbatim}

Оператор заміни s /// записується в такий спосіб:

  s / шаблон пошуку / вираз для заміни / [набір модифікаторів] 

При виконанні оператора s /// проводиться пошук відповідності шаблоном, і якщо пошук завершується успішно, знайдена подстрока замінюється зазначеним виразом. Подібно оператору m //, оператор s /// використовує змінну \$\_. Нижче наведено найпростіший приклад застосування оператора s ///.

  \$\_ = "CGI-сценарій написаний на мові С";
 s/C\$/Perl/;
 print; 

В результаті виконання сценарію на консоль буде виведена наступна рядок:

  CGI-сценарій написаний на мові Perl 

Оскільки символ С міститься в абревіатурі CGI, тому в шаблоні пошуку вказано, що він повинен бути останнім у рядку.

За останніми роздільником в операторі s /// можуть слідувати один або кілька модифікаторів. Призначення деяких модифікаторів наведено нижче.

    g - глобальний пошук. Якщо цей модифікатор не вказано, після виявлення першого відповідності оператор s /// закінчить свою роботу. Тому при відсутності модифікатора g буде вироблено не більше однієї заміни.
    i - вказує, що при пошуку слід ігнорувати регістр символів.
    e - вказує, що послідовність символів для заміни слід інтерпретувати не як підрядок, а як вираження Perl. 

У вираженні для підстановки можуть бути присутніми змінні $ 1 - $ 9, і в цьому випадку необхідно вказати модифікатор е. Так, наприклад, якщо потрібно інтерпретувати десяткове число як код символу, можна воспользоват'ся наступним виразом:

  s/([0-9]+)/chr(\$1)/e; 

щоб пошук або заміна проводилися в рядку, що міститься в потрібній змінної, треба використовувати наступне вираз:

  Мінлива = \~оператор\_поіска\_ілі\_замени 

Так, наприклад, для перетворення шістнадцяткових чисел, що містяться в змінній \$string, в десяткове уявлення можна використовувати інструкцію:

  \$string = \~s/([0-9A-Fa-f]+)(H h)/hex(\$1)/ge; 